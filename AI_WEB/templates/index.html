<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ™ºèƒ½å¯¹è¯</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="app-container">
    <div class="header">ğŸ¤– SuperChatbot Pro</div>
    
    <div id="chat-container">
        <div class="msg ai-msg">ä½ å¥½ï¼æ¨¡å‹å·²å°±ç»ªã€‚æˆ‘æ˜¯ä½ çš„æœ¬åœ° AI åŠ©æ‰‹ã€‚</div>
    </div>

    <div class="status-bar" id="status">AI æ­£åœ¨æ€è€ƒä¸­...</div>

    <div class="input-area">
        <input type="text" id="user-input" placeholder="è¾“å…¥æ¶ˆæ¯å¹¶æŒ‰å›è½¦..." onkeypress="if(event.keyCode==13) send()">
        <button id="send-btn" onclick="send()">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
            </svg>
        </button>
    </div>
</div>

<script>
    let chatHistory = [];

    async function send() {
        const input = document.getElementById('user-input');
        const text = input.value.trim();
        const status = document.getElementById('status');
        if (!text) return;

        appendMessage('user-msg', text);
        input.value = '';
        status.style.display = 'block';

        try {
            const response = await fetch('/ask', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: text, history: chatHistory })
            });
            const data = await response.json();

            appendMessage('ai-msg', data.response);

            chatHistory.push({role: "user", content: text});
            chatHistory.push({role: "assistant", content: data.response});
            if(chatHistory.length > 10) chatHistory.splice(0, 2);

        } catch (e) {
            appendMessage('ai-msg', "âŒ é”™è¯¯ï¼šæ— æ³•è¿æ¥åˆ° Python åç«¯ã€‚");
        } finally {
            status.style.display = 'none';
        }
    }

    function appendMessage(className, text) {
        const container = document.getElementById('chat-container');
        const div = document.createElement('div');
        div.className = `msg ${className}`;
        div.innerText = text;
        container.appendChild(div);
        container.scrollTop = container.scrollHeight;
    }
</script>
</body>
</html>